<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="og:title" content="Générer un flux RSS en Go" />
    <meta name="og:url" content="https://blog.otso.fr/2020-06-06-generer-un-flux-rss-en-go.html" />
    <meta name="og:site_name" content="Blob Trotter" />

    
    <meta name="description" content="Comment utiliser les bibliothèques standard Go pour générer un flux RSS valide" />
    <meta name="og:description" content="Comment utiliser les bibliothèques standard Go pour générer un flux RSS valide" />
     
    <meta name="robots" content="index, follow" />
     
    <meta name="og:type" content="article" />
     
    <meta name="og:image" content="https://blog.otso.fr/images/2020-06-06-generer-un-flux-rss-en-go/logo-rss.png" />
     
    <meta name="twitter:card" content="summary" />
     
    <meta name="twitter:site" content="@adriantombu" />
     
    <meta name="twitter:creator" content="@adriantombu" />
    

    <title>Générer un flux RSS en Go - Blob Trotter</title>

    <link rel="icon" href="./favicon.png" />
    <link href="./style.css" rel="stylesheet" type="text/css" />
    <link href="./rss.xml" type="application/rss+xml" />
    <link rel="canonical" href="https://blog.otso.fr/2020-06-06-generer-un-flux-rss-en-go.html" />
  </head>

  <body>
    <header>
      <nav>
        <a href="https://otso.fr">Accueil</a> &bull;
        <a href="https://otso.fr/index-en.html">In English</a> &bull; Blog
        &bull;
        <a href="https://otso.fr/conditions-generales-de-vente.html">CGV</a>
        &bull;
        <a href="https://otso.fr/mentions-legales.html">Mentions légales</a>
      </nav>
    </header>

    <article>
      <h1>Générer un flux RSS en Go</h1>

<p>Il y a quelques mois j&rsquo;ai entamé la création d&rsquo;un <a href="https://github.com/adriantombu/orion">générateur de blog statique en Go</a> pour me faire la main sur le langage et j&rsquo;ai souhaité y <strong>intégrer un flux RSS</strong>. Pourquoi me direz-vous ? Ce format de donnée a beau dater du millénaire précédent (la <a href="https://fr.wikipedia.org/wiki/RSS">première version du RSS</a> est sortie en 1999), il est encore largement répandu de nos jours sur les blogs et sites d&rsquo;informations et j&rsquo;en suis moi-même un fervent utilisateur grâce à Feedly.</p>

<p>La <strong>création d&rsquo;un flux RSS en Go</strong> est somme toute assez simple et ne requiert que l&rsquo;utilisation de la bibliothèque native <code>encoding/xml</code>.</p>

<p><img src="images/2020-06-06-generer-un-flux-rss-en-go/logo-rss.png" alt="Un joli logo RSS" /></p>

<h2>Étape 1 : créer les structures de données</h2>

<p>La première chose a faire est d&rsquo;aller faire un tour sur <a href="https://validator.w3.org/feed/docs/rss2.html">les spécifications RSS 2.0</a> (le site est vraiment très beau) pour découvrir comment est structuré un fichier <code>rss.xml</code> ainsi que les éléments obligatoires à renseigner.</p>

<p>La structure est composée de deux parties distinctes :</p>

<h3>Le canal, ou <code>channel</code></h3>

<p>C&rsquo;est la partie qui <strong>décrit le flux RSS</strong> et le site qui y est lié. Il n&rsquo;y a que 3 éléments obligatoires à renseigner :</p>

<ul>
<li><code>title</code> : qui représente le nom de votre site (<em>ex: Blob Trotter</em>)</li>
<li><code>link</code> : un lien vers le site correspondant au flux RSS (<em>ex: <a href="https://blog.otso.fr/">https://blog.otso.fr</a></em>)</li>
<li><code>description</code> : une petite description du contenu de votre site (<em>ex: Les pérégrinations d&rsquo;un développeur dans le monde de Javascript et de Go</em>)</li>
</ul>

<p>Il existe <strong>d&rsquo;autres éléments optionnels</strong> que vous retrouverez dans les spécifications, tels que la langue ou le copyright par exemple.</p>

<h3>Les éléments, ou <code>items</code></h3>

<p>C&rsquo;est <strong>la liste des articles</strong> que vous souhaitez partager dans votre flux RSS, sans que ceux-ci ne soient limités en nombre. Bien qu&rsquo;il soit possible d&rsquo;utiliser jusqu&rsquo;à 10 éléments pour décrire un article, <strong>la seule obligation</strong> est de renseigner un titre ou une description.</p>

<p>Sur mon projet, je suis parti sur le titre, le lien, la description, une image et la date de publication, afin d&rsquo;avoir un rendu plus plaisant visuellement dans un lecteur de flux RSS. Il est important de noter que le champ <code>description</code> peut comporter un texte simple mais également <strong>tout l&rsquo;article au format HTML</strong> (c&rsquo;est cette deuxième option que j&rsquo;utilise sur mon blog).</p>

<p>Au final on se retrouve donc avec une structure de données plutôt simple :</p>

<script src="https://gist.github.com/adriantombu/8553bc91c8a8b274efe610f88fb9381e.js"></script>

<h2>Étape 2 : la génération du fichier RSS</h2>

<p>Ici rien de bien sorcier, on va instancier une structure de type <code>rss</code>, et y intégrer tous les articles avant d&rsquo;écrire le fichier <code>rss.xml</code> sur le disque.</p>

<p>Voici le code final de la partie où l&rsquo;on <strong>génère le flux RSS</strong> :</p>

<script src="https://gist.github.com/adriantombu/6d597a241096e204e01b45fc4e3b6d59.js"></script>

<h2>Étape bonus : la date de publication de l&rsquo;article</h2>

<p>Je ne l&rsquo;ai pas ajouté dans l&rsquo;exemple ci-dessus mais il est possible d&rsquo;ajouter une <strong>date de publication</strong> pour les articles : c&rsquo;est le champ <code>pubDate</code> que j&rsquo;utilise également sur <a href="https://github.com/adriantombu/orion/blob/master/cmd/build/rss.go#L59">Orion</a> et qui a la particularité de devoir être spécifié au format <a href="https://www.feedvalidator.org/docs/error/InvalidRFC2822Date.html">RFC-822</a> mais avec l&rsquo;année sur 4 chiffres et non 2.</p>

<p>Heureusement pour nous il existe dans Go un format de date dans <a href="https://golang.org/pkg/time/#pkg-constants">les constantes de la bilbiothèque standard time</a> qui correspond à ce que l&rsquo;on recherche : <code>RFC1123Z</code></p>

<p>Il suffit donc de mettre à jour votre structure en ajoutant l&rsquo;élément <code>PubDate</code> :</p>

<script src="https://gist.github.com/adriantombu/2442178216f524a536da77251376bee5.js"></script>

<p>Dans mon générateur de blog, j&rsquo;utilise le format de date <code>YYYY-MM-DD</code> pour les dates de publication de mes articles, voici donc comment la <strong>transformer en un format RFC1123Z</strong> compatible avec un flux RSS (<em><a href="https://gobyexample.com/time-formatting-parsing">plus d&rsquo;infos sur time.Parse</a></em>) :</p>

<script src="https://gist.github.com/adriantombu/164feaf8c24940d592d6a446eff29efd.js"></script>

<p>Dans le même style, vous pouvez générer automatiquement la <strong>date de dernier build</strong> de votre flux RSS en ajoutant <code>LastBuildDate</code> dans votre channel :</p>

<script src="https://gist.github.com/adriantombu/9e312a263fedfb6fc8be20d79ec19380.js"></script>

<p>J&rsquo;espère que cet article vous aura permis de mieux comprendre <strong>comment générer un flux RSS</strong> en quelques lignes de Go, et de manière plus générale comment <strong>créer un fichier XML</strong> à partir d&rsquo;une structure, en utilisant uniquement les bibliothèques standard du langage.</p>

<p>Vous pouvez retrouver la totalité du code de cet article sur Gist : <a href="https://gist.github.com/adriantombu/1d669358839b4559484dd2fc53cad732">Un script de génération de flux RSS en go</a></p>

<p>Envie de me <strong>donner votre avis</strong> sur cet article ou discuter de Go en général ? Venez me faire coucou sur <a href="https://twitter.com/adriantombu">Twitter</a> !</p>

    </article>

    <footer>
      <nav>
        
        <p>
          <a href="index.html"
            >&lt;&lt; Et si on passait de master à main dans nos repos Git ?</a
          >
        </p>
         
        <p>
          <a href="2020-05-08-passez-en-monorepo-avec-lerna.html"
            >Comment passer au monorepo avec Lerna &gt;&gt;</a
          >
        </p>
        
      </nav>
    </footer>
  </body>
</html>
